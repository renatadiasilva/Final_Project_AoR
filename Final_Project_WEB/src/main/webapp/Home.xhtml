<ui:composition template="WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="titulo">#{styleSessionManagement.companyName}</ui:define>

	<ui:define name="header-menus">
		<f:metadata>
			<!-- Se houver um user logado redirecciona para a respectiva Landing.xhtml -->
			<f:viewAction
				actionListener="#{userSessionManagement.checkForUser()}" />

		</f:metadata>

		<ui:include src="WEB-INF/template/check-position.xhtml" />

		<h:panelGrid columns="3">

			<h:form id="header-login">
				<h:panelGrid columns="6">

					<p:inputText id="login-email" value="#{loginCDI.email}" size="35"
						required="true" requiredMessage="Insira um email." />
					<p:watermark for="login-email" value="Email" />

					<div id="caps-lock" style="display: none; color: #fff">Caps
						lock ligado!</div>

					<p:password id="login-password" value="#{loginCDI.password}"
						size="35" required="true" requiredMessage="Insira a password."
						onkeypress="checkCaps()" />
					<p:watermark for="login-password" value="Password" />

					<p:commandButton value="Login" action="#{loginCDI.login()}"
						ajax="false" icon="ui-icon-key" />

				</h:panelGrid>
			</h:form>

			<h:form id="header-signup">
				<p:commandButton value="Signup" oncomplete="PF('signup').show();"
					update="messages signupForm" icon="ui-icon-person"
					style="margin:none" />
			</h:form>

			<h:form id="header-recover">
				<p:commandButton value="Recuperar password"
					update="messages recoverPasswordForm"
					oncomplete="PF('recoverPassword').show();" icon="ui-icon-help"
					style="margin:none" />
			</h:form>

		</h:panelGrid>

		<!-- Recuperação da password Dialog -->
		<h:form id="recoverPasswordForm">

			<p:dialog header="Recuperar Password" widgetVar="recoverPassword"
				draggable="false" resizable="false" modal="true">

				<h:panelGroup id="recoverPasswordDialog">

					<p:messages />

					<h:panelGrid columns="2">

						<p:outputLabel value="Email da conta: "
							for="recover-password-email" />
						<p:inputText id="recover-password-email"
							value="#{recoverPasswordCDI.emailRecovery}" size="35"
							required="true" requiredMessage="Insira um email.">
							<o:validator validatorId="javax.faces.RegularExpression"
								message="Insira um email válido."
								pattern="^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,6})$" />
						</p:inputText>

					</h:panelGrid>

					<p:commandButton value="Recuperar Password"
						actionListener="#{recoverPasswordCDI.recover()}"
						update="recoverPasswordDialog" icon="ui-icon-mail-closed"
						style="width: 100%" />

					<p:button value="Fechar" icon="ui-icon-close" style="width: 100%"
						onclick="PF('recoverPassword').hide();" update="messages" />

				</h:panelGroup>

			</p:dialog>

		</h:form>


		<!-- SignUp Dialog -->
		<h:form id="signupForm">

			<p:dialog header="Novo Registo" widgetVar="signup" draggable="false"
				resizable="false" modal="true" height="536">

				<h:panelGroup id="signupDialog">

					<h:panelGrid columns="2">

						<p:outputLabel value="Email: " for="signup-email" />
						<p:inputText id="signup-email" value="#{signupCDI.email}"
							size="35" required="true" requiredMessage="Insira um email.">
							<o:validator validatorId="javax.faces.RegularExpression"
								message="Insira um email válido."
								pattern="^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,6})$" />
						</p:inputText>

						<p:outputLabel value="Password: " for="signup-password" />
						<p:password id="signup-password" value="#{signupCDI.password}"
							size="35" required="true" feedback="true" weakLabel="Fraca"
							goodLabel="Boa" strongLabel="Forte"
							validatorMessage="Passwords não combinam."
							promptLabel="Insira uma senha" match="signup-repeatPassword"
							requiredMessage="Insira uma password." />

						<p:outputLabel value="Repita a Password: "
							for="signup-repeatPassword" />
						<p:password id="signup-repeatPassword" size="35" required="true"
							requiredMessage="Repita a password." />

						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />

						<p:outputLabel value="Primeiro Nome: " for="signup-firstName" />
						<p:inputText id="signup-firstName" value="#{signupCDI.firstName}"
							size="35" required="true"
							requiredMessage="Insira o primeiro nome."
							maxlength="#{max.length.userFirstName()}" />

						<p:outputLabel value="Sobrenome: " for="signup-lastName" />
						<p:inputText id="signup-lastName" value="#{signupCDI.lastName}"
							size="35" required="true" requiredMessage="Insira o sobrenome."
							maxlength="#{max.length.userLastName()}" />

						<p:outputLabel value="Data de Nascimento: " for="signup-birthday" />
						<p:calendar id="signup-birthday" value="#{signupCDI.birthday}"
							pattern="dd/MM/yyyy" readonlyInput="true" navigator="true"
							yearRange="c-100:c+0" maxdate="#{signupCDI.maxDate}" locale="pt"
							size="35" />

						<p:outputLabel value="Telefone: " for="signup-homePhone" />
						<p:inputMask mask="999 999 999" id="signup-homePhone"
							value="#{signupCDI.homePhone}" size="35" maxlength="20" />

						<p:outputLabel value="Telemóvel: " for="signup-mobilePhone" />
						<p:inputMask mask="999 999 999" id="signup-mobilePhone"
							value="#{signupCDI.mobilePhone}" size="35" maxlength="20"
							required="true" requiredMessage="Insira o número de telemóvel." />

						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />

						<p:outputLabel value="Morada: " for="signup-adress" />
						<h:panelGroup>
							<p:inputTextarea id="signup-adress" value="#{signupCDI.address}"
								cols="35" rows="3" counter="maxAdress" counterTemplate=" - {0}"
								required="true" requiredMessage="Insira a morada."
								maxlength="#{max.length.userInfoAddress()}" />
							<h:outputText id="maxAdress" />
						</h:panelGroup>

						<p:outputLabel value="Cidade: " for="signup-city" />
						<p:inputText id="signup-city" value="#{signupCDI.city}" size="35"
							required="true" requiredMessage="Insira a cidade."
							maxlength="#{max.length.userInfoCity()}" />

						<p:outputLabel value="País: " for="signup-country" />
						<p:autoComplete id="signup-country" value="#{signupCDI.country}"
							size="35" required="true" requiredMessage="Insira o país."
							maxlength="#{max.length.userInfoCountry()}" maxResults="10"
							completeMethod="#{countryListCDI.getCountries}" />

						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />
						<p:outputLabel />

						<p:outputLabel value="Curso: " for="signup-course" />
						<p:inputText id="signup-course" value="#{signupCDI.course}"
							size="35" required="true" requiredMessage="Insira o curso."
							maxlength="#{max.length.userInfoCourse()}" />

						<p:outputLabel value="Escola/Universidade: " for="signup-school" />
						<p:inputText id="signup-school" value="#{signupCDI.school}"
							size="35" required="true" requiredMessage="Insira a escola."
							maxlength="#{max.length.userInfoSchool()}" />

						<p:outputLabel value="LinkedIn: " for="signup-linkedin" />
						<p:inputText id="signup-linkedin" value="#{signupCDI.linkedin}"
							size="35" />

					</h:panelGrid>

					<p:messages />

					<p:commandButton value="Signup"
						actionListener="#{signupCDI.signUp()}" icon="ui-icon-person"
						style="width: 100%" update="signupDialog" />

					<p:button value="Fechar" icon="ui-icon-close" style="width: 100%"
						onclick="PF('signup').hide();" update="@all" />

				</h:panelGroup>

			</p:dialog>

		</h:form>

	</ui:define>

	<ui:define name="contents">
		<h:form>
			<p:commandButton value="Populate" ajax="false"
				actionListener="#{initDB.populate()}" />
		</h:form>

		<br />
		<br />
		<br />
			#{styleSessionManagement.welcomeMessage}
			<br />
		<br />
			#{styleSessionManagement.companyDescription}
			<br />
		<br />
		<br />

		<!-- Pesquisas -->
		<h:panelGrid columns="3" style="width:100%">

			<!-- code and title?? -->
			<h:form id="search-code-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por código: " for="search-code" />
					<p:inputText id="search-code" value="#{positionSearchCDI.code}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByCode()}"
						update="tableHome messages" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-title-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por título: " for="search-title" />
					<p:inputText id="search-title" value="#{positionSearchCDI.title}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByTitle()}"
						update="tableHome messages" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-company-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por empresa: " for="search-company" />
					<p:inputText id="search-company"
						value="#{positionSearchCDI.company}" style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByCompany()}"
						update="tableHome messages" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-tarea-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por área técnica: " for="search-tarea" />
					<p:inputText id="search-tarea" value="#{positionSearchCDI.tarea}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByTechArea()}"
						update="tableHome messages" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

		</h:panelGrid>

		<h:panelGrid columns="3" style="width:100%">
			<h:form id="search-locations-out">
				<h:panelGroup>
					<p:outputLabel value="Coimbra: " for="searchPos-coimbra" />
					<p:selectBooleanCheckbox id="searchPos-coimbra"
						value="#{positionSearchCDI.coimbra}" />

					<p:outputLabel value="Porto: " for="searchPos-porto" />
					<p:selectBooleanCheckbox id="searchPos-porto"
						value="#{positionSearchCDI.porto}" />

					<p:outputLabel value="Lisboa: " for="searchPos-lisboa" />
					<p:selectBooleanCheckbox id="searchPos-lisboa"
						value="#{positionSearchCDI.lisboa}" />

				</h:panelGroup>
				<h:panelGroup>
					<p:commandButton value="Procurar posições com uma das localizações"
						action="#{positionSearchCDI.searchPositionsByLocationsOne()}"
						update="tableHome messages" icon="ui-icon-search" />
					<p:commandButton
						value="Procurar posições com todas as localizações"
						action="#{positionSearchCDI.searchPositionsByLocationsAll()}"
						update="tableHome messages" icon="ui-icon-search" />
				</h:panelGroup>
			</h:form>
			<h:form style="width:100%">
				<p:commandButton action="#{positionSearchCDI.cleanAll()}"
					value="Limpar pesquisa"
					update="search-code-out search-company-out search-tarea-out
						search-locations-out
						  search-title-out tableHome messages"
					icon="ui-icon-cancel" />
			</h:form>
		</h:panelGrid>

		<h:form id="tableHome">
			<p:dataTable emptyMessage="Neste momento não há posições abertas."
				var="p" value="#{checkPositionCDI.positions}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">

				<f:facet name="header">Posições Abertas</f:facet>
				<p:column headerText="Posição">
					<h:outputText value="#{p.positionCode} '#{p.title}'" />
				</p:column>
				<p:column headerText="Data Abertura">
					<h:outputText value="#{p.openingDate}" />
				</p:column>
				<p:column headerText="Vagas">
					<h:outputText value="#{p.openings}" />
				</p:column>
				<p:column headerText="Empresa">
					<h:outputText value="#{p.company}" />
				</p:column>
				<p:column headerText="Área Técnica">
					<h:outputText value="#{p.technicalArea}" />
				</p:column>
				<p:column headerText="Localizações">
					<h:outputText value="#{p.allLocations()}" />
				</p:column>
				<p:column headerText="Descrição">
					<p:commandButton value="Ver descrição" icon="ui-icon-script"
						actionListener="#{checkPositionCDI.checkPosition(p)}"
						update="checkPositionForm" style="width:100%"
						oncomplete="PF('checkPosition').show();" />
				</p:column>
				<p:column headerText="Candidatar-se">
					<p:commandButton value="Registar-se"
						oncomplete="PF('signup').show();" update="messages signupForm"
						icon="ui-icon-locked" style="width: 100%" />
				</p:column>
			</p:dataTable>

		</h:form>
	</ui:define>

</ui:composition>