<ui:composition template="../../../WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="titulo">Bem-vind@!
	 - #{styleSessionManagement.companyName}</ui:define>

	<ui:define name="contents">
		<f:metadata>
			<f:viewAction
				actionListener="#{userSessionManagement.checkTemporaryPassword()}" />
			<f:viewAction
				actionListener="#{newSubmissionCDI.dissociatePosition()}" />
			<f:viewAction
				actionListener="#{checkPositionCDI.init()}" />
		</f:metadata>
		<br />
		<b>CANDIDATO(A) #{userSessionManagement.userFullName}</b>,
		<br />
		<br /> 
		#{styleSessionManagement.welcomeMessage}
		<br />
		<br />
		#{userSessionManagement.bithdayMessage()}
		<br />
		<br />
		<br />
		<h3>Acesso rápido</h3>
		<br />
		<h:form id="quickAccessCandidate">
			<p:link value="As Minhas Candidaturas"
				href="../submissions/MySubmissions.xhtml" />
			<br />
			<br />
			<p:commandLink value="Submeter Candidatura Espontânea"
				rendered="#{userSessionManagement.cv}"
				oncomplete="PF('spontaneousSubmission').show();" />
			<p:commandLink
				value="Faça Upload do CV para se poder candidatar 
					ou submeter uma candidatura espontânea"
				onclick="PF('uploadCVLocal').show();"
				rendered="#{!userSessionManagement.cv}" style="width: 100%" />
		</h:form>
		<br />
		<br />
		<br />
		<br />
		<br />

		<!-- Pesquisas -->
		<h:panelGrid style="width:100%">
			<h:form id="search-keyword-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por keyword: "
					 	for="search-keyword" />
					<p:inputText id="search-keyword"
					 	value="#{checkPositionCDI.keyword}"
						style="width:100%" />
					<p:commandButton
						action="#{checkPositionCDI.searchOpenPositionsByKeyword()}"
						update="openPositionsForm messages" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>
		</h:panelGrid>

		<h:form id="openPositionsForm">

			<p:dataTable emptyMessage="Neste momento não há posições abertas."
				var="p" value="#{checkPositionCDI.positions}" id="tableHome"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">

				<f:facet name="header">Posições Abertas</f:facet>
				<p:column headerText="Código">
					<h:outputText value="#{p.positionCode}" />
				</p:column>
				<p:column headerText="Título">
					<h:outputText value="#{p.title}" />
				</p:column>
				<p:column headerText="Vagas">
					<h:outputText value="#{p.openings}" />
				</p:column>
				<p:column headerText="Empresa">
					<h:outputText value="#{p.company}" />
				</p:column>
				<p:column headerText="Área Técnica">
					<h:outputText value="#{p.technicalArea}" />
				</p:column>
				<p:column headerText="Localizações">
					<h:outputText value="#{p.allLocations()}" />
				</p:column>
				<p:column headerText="Descrição">
					<p:commandButton value="Ver descrição" icon="ui-icon-script"
						actionListener="#{checkPositionCDI.checkPosition(p)}"
						update="checkPositionForm" style="width:100%"
						oncomplete="PF('checkPosition').show();" />
				</p:column>
				<p:column headerText="Candidatar-se"
					rendered="#{!userSessionManagement.cv}">
					<p:commandButton value="Upload CV"
						onclick="PF('uploadCVLocal').show();" icon="ui-icon-locked"
						style="width: 100%" />
				</p:column>

				<p:column headerText="Candidatar-se"
					rendered="#{userSessionManagement.cv}">
					<!-- 1ª Não mudar a ordem -->
					<p:button value="Acesso negado" icon="ui-icon-cancel"
						rendered="#{checkPositionCDI.forbidden(p)}" style="width: 100%" />
					<!-- 2ª Não mudar a ordem -->
					<p:button value="Candidato" icon="ui-icon-check"
						rendered="#{checkPositionCDI.candidate(p)}" style="width: 100%" />
					<!-- 3ª Não mudar a ordem -->
					<p:commandButton value="Candidatar-se" icon="ui-icon-suitcase"
						rendered="#{checkPositionCDI.submitable()}"
						update="newSubmissionForm1 newSubmissionForm2 newSubmissionForm3 newSubmissionForm4"
						actionListener="#{newSubmissionCDI.associatePosition(p)}"
						style="width: 100%" />
				</p:column>

			</p:dataTable>

			<p:dialog header="Upload CV" widgetVar="uploadCVLocal"
				draggable="false" resizable="false" modal="true">

				<p:fileUpload id="file-upload-local"
					update="@form messages headerMenu quickAccessCandidate"
					label="Escolha o CV (*.pdf)" uploadLabel="Submeter CV"
					cancelLabel="Cancelar" required="true"
					requiredMessage="Submeta um CV"
					fileUploadListener="#{uploadCVCDI.uploadCV}" mode="advanced"
					dragDropSupport="true" sizeLimit="1000000" fileLimit="1"
					invalidSizeMessage="Ficheiro demaisado grande (max. 1Mb)."
					invalidFileMessage="Só é permitido o formato .pdf"
					allowTypes="/(\.|\/)(pdf)$/" oncomplete="PF('uploadCV').hide();" />

				<p:button value="Cancelar" onclick="PF('uploadCVLocal').hide();"
					icon="ui-icon-close" style="width:100%" />

			</p:dialog>

		</h:form>

		<h:form id="newSubmissionForm1">
			<h:panelGroup rendered="#{newSubmissionCDI.hasPosition()}">

				<h3>Como soube desta posição?</h3>
				<!-- Advertisement Channels -->
				<h:panelGrid id="newPositionAd" columns="4">

					<p:outputLabel value="Expresso: " />
					<p:selectBooleanCheckbox value="#{newSubmissionCDI.expresso}">
						<p:ajax update="@this" />
					</p:selectBooleanCheckbox>

					<p:outputLabel value="LinkedIn: " />
					<p:selectBooleanCheckbox value="#{newSubmissionCDI.linkedin}">
						<p:ajax update="@this" />
					</p:selectBooleanCheckbox>

					<p:outputLabel value="Glassdoor: " />
					<p:selectBooleanCheckbox value="#{newSubmissionCDI.glassdoor}">
						<p:ajax update="@this" />
					</p:selectBooleanCheckbox>

					<p:outputLabel value="Facebook: " />
					<p:selectBooleanCheckbox value="#{newSubmissionCDI.facebook}">
						<p:ajax update="@this" />
					</p:selectBooleanCheckbox>

					<p:outputLabel value="Net-emprego: " />
					<p:selectBooleanCheckbox value="#{newSubmissionCDI.netemprego}">
						<p:ajax update="@this" />
					</p:selectBooleanCheckbox>

				</h:panelGrid>
				<p:outputLabel />
				<p:outputLabel />

			</h:panelGroup>
		</h:form>

		<h:form id="newSubmissionForm2">
			<p:dataTable id="altAdvertisementChannels" var="advertisingChannel"
				value="#{newSubmissionCDI.altAdvertisingChannels}"
				style="width:300px" rendered="#{newSubmissionCDI.hasPosition()}"
				emptyMessage="Sem fontes alternativas">
				<p:column headerText="Outras fontes">
					<p:outputLabel value="#{advertisingChannel.ad}" />
				</p:column>
				<p:column headerText="Remover">
					<p:commandButton
						actionListener="#{newSubmissionCDI.deleteAltAdvertisingChannels(advertisingChannel)}"
						icon="ui-icon-trash" update="@form" />
				</p:column>
			</p:dataTable>
		</h:form>

		<h:form id="newSubmissionForm3">
			<h:panelGrid columns="3" style="widht:300px"
				rendered="#{newSubmissionCDI.hasPosition()}">
				<p:inputText id="new-position-extra-ad"
					value="#{newSubmissionCDI.extraAd}" />
				<p:watermark for="new-position-extra-ad"
					value="Insira mais canais de publicidade" />
				<p:commandButton icon="ui-icon-plus"
					update="newSubmissionForm2 newSubmissionForm3"
					actionListener="#{newSubmissionCDI.addAltAdvertisingChannels()}" />
			</h:panelGrid>
		</h:form>

		<br />

		<h:form id="newSubmissionForm4">
			<h:panelGroup rendered="#{newSubmissionCDI.hasPosition()}">
				<p:fileUpload id="motivation-letter-upload-new-submission"
					update="newSubmissionForm1 newSubmissionForm2 newSubmissionForm3
					newSubmissionForm4 messages openPositionsForm quickAccessCandidate"
					label="Escolha a carta de motivação (*.pdf)"
					uploadLabel="Submeter candidatura" cancelLabel="Cancelar"
					required="true" requiredMessage="Submeta uma carta de motivação"
					fileUploadListener="#{newSubmissionCDI.newSubmission}"
					mode="advanced" dragDropSupport="true" sizeLimit="1000000"
					fileLimit="1"
					invalidSizeMessage="Ficheiro demaisado grande (max. 1Mb)."
					invalidFileMessage="Só é permitido o formato .pdf"
					allowTypes="/(\.|\/)(pdf)$/"
					oncomplete="PF('newSubmission').hide();" />

				<p:commandButton value="Cancelar"
					actionListener="#{newSubmissionCDI.dissociatePosition()}"
					update="newSubmissionForm1 newSubmissionForm2 newSubmissionForm3 newSubmissionForm4"
					icon="ui-icon-close" style="width:100%" />
			</h:panelGroup>
		</h:form>

	</ui:define>

</ui:composition>