<ui:composition template="../../../WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:metadata>
			<f:viewAction
				actionListener="#{manageInterviewsCDI.loadRole(userSessionManagement.userMail, 'false')}" />
		</f:metadata>
	</f:metadata>

	<ui:define name="titulo">
	Entrevistador - Gerir Entrevistas - #{styleSessionManagement.companyName}
	</ui:define>

	<ui:define name="contents">

		<h1>Gerir Entrevistas</h1>

		<h:form id="viewPositionForm">

			<p:dialog header="#{manageInterviewScriptCDI.position.positionCode}"
				widgetVar="checkPosition" draggable="false" resizable="false"
				modal="true">

				<h:panelGrid columns="2">
					<p:outputLabel value="Título:" />
					<p:outputLabel value="#{manageInterviewScriptCDI.position.title}" />
					<p:outputLabel />
					<p:outputLabel />
					<p:outputLabel value="Empresa:" />
					<p:outputLabel value="#{manageInterviewScriptCDI.position.company}" />
					<p:outputLabel />
					<p:outputLabel />
					<p:outputLabel value="Descrição:" />

				</h:panelGrid>

				<p:inputTextarea cols="50" rows="10" readonly="true"
					value="#{manageInterviewScriptCDI.position.description}" />
				<p:outputLabel />

				<p:commandButton value="Fechar" style="width:100%"
					icon="ui-icon-close" onclick="PF('checkPosition').hide();" />

			</p:dialog>

		</h:form>

		<h:form id="myInterviews">

			<p:dataTable
				emptyMessage="Não há entrevistas por realizar ou não há entrevistas por realizar nesta pesquisa."
				var="interview" value="#{manageInterviewsCDI.interviews}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">

				<f:facet name="header">#{manageInterviewsCDI.headerTable}</f:facet>

				<p:column headerText="Data">
					<h:outputText
						value="#{manageInterviewsCDI.displayDate(interview.date)}" />
				</p:column>

				<p:column headerText="Consultar posição">
					<p:commandButton
						value="#{interview.submission.position.positionCode}"
						style="width:100%" update="@form viewPositionForm"
						oncomplete="PF('checkPosition').show();"
						action="#{manageInterviewScriptCDI.loadPosition(interview.submission.position)}" />
				</p:column>

				<p:column headerText="Candidato">
					<p:outputLabel
						value="#{interview.submission.candidate.firstName} #{interview.submission.candidate.lastName}" />
				</p:column>

				<p:column headerText="Carta de Motivação">
					<a
						href="#{submissionSearchCDI.getMotivatioLetterPath(interview.submission)}"
						target="_blank">Carta de Motivação</a>
				</p:column>

				<p:column headerText="CV">
					<a href="#{submissionSearchCDI.getCvPath(interview.submission)}"
						target="_blank">Consultar CV</a>
				</p:column>

				<p:column headerText="Consultar/Baixar Guião">

					<p:commandButton value="Consultar/Baixar" style="width:100%"
						ajax="false"
						rendered="#{!manageInterviewScriptCDI.currentScript(interview.script)}"
						action="#{manageInterviewScriptCDI.loadInterview(interview)}"
						actionListener="#{manageInterviewsCDI.unloadInterview()}"
						icon="ui-icon-script" />

					<p:commandButton value="Fechar" style="width:100%" ajax="false"
						rendered="#{manageInterviewScriptCDI.currentScript(interview.script)}"
						actionListener="#{manageInterviewScriptCDI.unloadInterview()}"
						icon="ui-icon-close" />

				</p:column>

				<!-- Para ADMIN/MANAGER -->
				<p:column headerText="Editar Entrevista"
					rendered="#{!manageInterviewsCDI.interviewer}">

					<p:commandButton value="Editar" style="width:100%"
						icon="ui-icon-pencil" ajax="false"
						action="#{manageInterviewsCDI.loadInterview(interview)}"
						actionListener="#{manageInterviewScriptCDI.unloadInterview()}"
						rendered="#{!manageInterviewsCDI.showEditInterview(interview.submission)}" />

					<p:commandButton value="Cancelar" style="width:100%"
						icon="ui-icon-close" ajax="false"
						action="#{manageInterviewsCDI.unloadInterview()}"
						rendered="#{manageInterviewsCDI.showEditInterview(interview.submission)}" />

				</p:column>

				<p:column headerText="Concluir Entrevista">

					<p:commandButton value="Concluir" style="width:100%"
						icon="ui-icon-check" ajax="false"
						action="#{manageInterviewsCDI.loadInterviewToConclude(interview)}"
						actionListener="#{manageInterviewScriptCDI.unloadInterview()}"
						rendered="#{!manageInterviewsCDI.checkInterviewToConclude(interview)}" />

					<p:commandButton value="Cancelar" style="width:100%"
						icon="ui-icon-close" ajax="false"
						actionListener="#{manageInterviewsCDI.cancelConcludeInterview()}"
						rendered="#{manageInterviewsCDI.checkInterviewToConclude(interview)}" />

				</p:column>

			</p:dataTable>
			<br />
		</h:form>

		<br />

		<h:form id="viewScript">
			<h:panelGroup rendered="#{manageInterviewScriptCDI.hasScript()}">

				<p:dataTable id="xls" emptyMessage="Sem Perguntas" var="question"
					value="#{manageInterviewScriptCDI.script.questions}"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
					{PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
					paginator="true" rows="10">

					<f:facet name="header">
						<h:outputText value="#{manageInterviewScriptCDI.interviewTitle()}" />
					</f:facet>

					<p:column>
						<f:facet name="header">
							<h:outputText value="Questão" />
						</f:facet>
						<p:outputLabel value="#{question.question}" />
					</p:column>

					<p:column>
						<f:facet name="header">
							<h:outputText value="Tipo de resposta" />
						</f:facet>
						<p:outputLabel
							value="#{manageInterviewScriptCDI.questionType(question)}" />
					</p:column>

				</p:dataTable>

				<h:panelGroup style="width:100%">
					<div style="float: left">
						<h:commandLink value="Baixar .xls">
							<p:graphicImage library="images/logos" name="xls.png" />
							<p:dataExporter type="xls" target="xls"
								fileName="#{manageInterviewScriptCDI.interviewTitle()}" />
						</h:commandLink>
					</div>
				</h:panelGroup>

			</h:panelGroup>

		</h:form>

		<h:form id="candidateCarriedInterviews">

			<h:panelGroup rendered="#{manageInterviewScriptCDI.hasScript()}">

				<br />
				<br />
				<br />

				<p:dataTable emptyMessage="Sem entrevistas realizadas."
					var="interview"
					value="#{manageInterviewScriptCDI.candidateInterviews}"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
					{PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
					paginator="true" rows="10">

					<f:facet name="header">Entrevistas realizadas ao candidato</f:facet>

					<p:column headerText="Data">
						<h:outputText
							value="#{manageInterviewScriptCDI.displayDate(interview.date)}" />
					</p:column>

					<p:column headerText="Consultar posição">
						<p:commandButton
							value="#{interview.submission.position.positionCode}"
							style="width:100%" update="@form viewPositionForm"
							oncomplete="PF('checkPosition').show();"
							action="#{manageInterviewScriptCDI.loadPosition(interview.submission.position)}" />
					</p:column>

					<p:column headerText="Candidato">
						<p:outputLabel
							value="#{interview.submission.candidate.firstName} #{interview.submission.candidate.lastName}" />
					</p:column>

					<p:column headerText="Carta de Motivação">
						<a
							href="#{submissionSearchCDI.getMotivatioLetterPath(interview.submission)}"
							target="_blank">Consultar a Carta de Motivação</a>
					</p:column>

					<p:column headerText="CV">
						<a href="#{submissionSearchCDI.getCvPath(interview.submission)}"
							target="_blank">Consultar CV</a>
					</p:column>

					<p:column headerText="Ver Feedback">

						<p:commandButton value="Feedback" style="width:100%"
							actionListener="#{manageInterviewScriptCDI.setInterviewFeedback(interview.feedback)}"
							icon="ui-icon-comment" oncomplete="PF('checkFeedback').show();"
							update="interviewFeedback" />

					</p:column>

					<p:column headerText="Baixar Entrevista">

						<a href="#{manageInterviewScriptCDI.interviewXLSPath(interview)}"
							target="_blank">Baixar</a>

					</p:column>

				</p:dataTable>

			</h:panelGroup>

		</h:form>

		<h:form id="interviewFeedback">
			<p:dialog header="#{interview.submission.position.positionCode}"
				widgetVar="checkFeedback" draggable="false" resizable="false"
				modal="true">

				<h:panelGrid columns="1">
					<p:outputLabel value="Feedback:" />
					<p:inputTextarea cols="50" rows="10" readonly="true"
						value="#{manageInterviewScriptCDI.interviewFeedback}" />
					<p:outputLabel />
				</h:panelGrid>

				<p:commandButton value="Fechar" style="width:100%"
					icon="ui-icon-close" onclick="PF('checkFeedback').hide();" />

			</p:dialog>
		</h:form>

		<br />

		<ui:include src="conclude-interview.xhtml" />

		<ui:include src="edit-interview.xhtml" />

	</ui:define>

</ui:composition>