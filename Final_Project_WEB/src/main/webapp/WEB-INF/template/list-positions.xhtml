<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">
<h:head></h:head>
<h:body>

	<ui:composition>

		<!-- Pesquisas -->
		<h:panelGrid columns="3" style="width:100%">

			<h:form id="search-all-positions" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:commandButton value="Todas"
						action="#{positionSearchCDI.searchAll()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search"
						style="width:100%" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-code-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por código: " for="search-code" />
					<p:inputText id="search-code" value="#{positionSearchCDI.code}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByCode()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-title-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por título: " for="search-title" />
					<p:inputText id="search-title" value="#{positionSearchCDI.title}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByTitle()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-company-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por empresa: " for="search-company" />
					<p:inputText id="search-company"
						value="#{positionSearchCDI.company}" style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByCompany()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-tarea-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por área técnica: " for="search-tarea" />
					<p:inputText id="search-tarea" value="#{positionSearchCDI.tarea}"
						style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByTechArea()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

			<h:form id="search-keywordPos-out" style="width:100%">
				<h:panelGrid columns="3" style="width:100%">
					<p:watermark value="Procurar por palavra chave: "
						for="search-keywordPos" />
					<p:inputText id="search-keywordPos"
						value="#{positionSearchCDI.keyword}" style="width:100%" />
					<p:commandButton
						action="#{positionSearchCDI.searchPositionsByKeyword()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>

		</h:panelGrid>

		<h:panelGrid columns="3" style="width:100%">
			<h:form id="search-datePos-out">
				<h:panelGroup>
					<p:outputLabel value="De : " for="search-date1Pos" />
					<p:calendar id="search-date1Pos" value="#{positionSearchCDI.date1}"
						pattern="dd/MM/yyyy" readonlyInput="true" navigator="true"
						yearRange="c-100:c+100" locale="pt" size="35" />
				</h:panelGroup>

				<h:panelGroup>
					<p:outputLabel value="Até: " for="search-date2Pos" />
					<p:calendar id="search-date2Pos" value="#{positionSearchCDI.date2}"
						pattern="dd/MM/yyyy" readonlyInput="true" navigator="true"
						yearRange="c-100:c+100" locale="pt" size="35" />
				</h:panelGroup>
				<h:panelGroup>
					<p:commandButton value="Procurar por data"
						action="#{positionSearchCDI.searchPositionsByDate()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGroup>
			</h:form>

			<h:form id="search-status-out">
				<h:panelGrid columns="5" style="width:100%">
					<p:outputLabel value="Estado: " for="search-status" />
					<p:selectOneMenu id="search-status" style="width:100%"
						value="#{positionSearchCDI.status}">
						<f:selectItems value="#{positionSearchCDI.availableStatus}" />
						<f:ajax event="change" />
					</p:selectOneMenu>

					<p:commandButton value="Procurar por estado"
						action="#{positionSearchCDI.searchPositionsByStatus()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGrid>
			</h:form>
		</h:panelGrid>

		<h:panelGrid columns="3" style="width:100%">
			<h:form id="search-locations-out">
				<h:panelGroup>
					<p:outputLabel value="Coimbra: " for="searchPos-coimbra" />
					<p:selectBooleanCheckbox id="searchPos-coimbra"
						value="#{positionSearchCDI.coimbra}" />

					<p:outputLabel value="Porto: " for="searchPos-porto" />
					<p:selectBooleanCheckbox id="searchPos-porto"
						value="#{positionSearchCDI.porto}" />

					<p:outputLabel value="Lisboa: " for="searchPos-lisboa" />
					<p:selectBooleanCheckbox id="searchPos-lisboa"
						value="#{positionSearchCDI.lisboa}" />

					<p:outputLabel value="Outro local: " for="searchPos-otherl" />
					<p:selectBooleanCheckbox id="searchPos-otherl"
						value="#{positionSearchCDI.other}" />

					<p:outputLabel value="Local: " for="searchPos-location" />
					<p:inputText id="searchPos-location"
						value="#{positionSearchCDI.location}" size="35" />
				</h:panelGroup>
				<h:panelGroup>
					<p:commandButton value="Procurar por localização"
						action="#{positionSearchCDI.searchPositionsByLocationsOne()}"
						update="myPositionsTable messages
						editSubmissionReason editSubmissionStatus" icon="ui-icon-search" />
				</h:panelGroup>
			</h:form>
			<h:form style="width:100%">
				<p:commandButton action="#{positionSearchCDI.cleanAll()}"
					value="Limpar pesquisa"
					update="search-code-out search-company-out search-tarea-out
						search-status-out search-datePos-out search-locations-out
						  search-title-out search-keywordPos-out 
						  editSubmissionReason editSubmissionStatus myPositionsTable messages"
					icon="ui-icon-cancel" />
			</h:form>
		</h:panelGrid>

		<br />
		<br />
		<h:form id="myPositionsTable">
			<p:dataTable emptyMessage="#{positionSearchCDI.headerTable}" var="p"
				value="#{positionSearchCDI.plist}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">
				<f:facet name="header">Listagem</f:facet>
				<p:column headerText="Código">
					<h:outputText value="#{p.positionCode}" />
				</p:column>
				<p:column headerText="Título">
					<h:outputText value="#{p.title}" />
				</p:column>
				<p:column headerText="Data Abertura">
					<h:outputText value="#{p.openingDate}" />
				</p:column>
				<p:column headerText="Localizações">
					<h:outputText value="#{p.allLocations()}" />
				</p:column>
				<p:column headerText="Estado">
					<h:outputText value="#{p.status}" />
				</p:column>
				<p:column headerText="Empresa">
					<h:outputText value="#{p.company}" />
				</p:column>
				<p:column headerText="Área Técnica">
					<h:outputText value="#{p.technicalArea}" />
				</p:column>
				<p:column headerText="Descrição">
					<p:commandButton value="Descrição" icon="ui-icon-script"
						actionListener="#{checkPositionCDI.checkPosition(p)}"
						update="checkPositionForm" style="width:100%"
						oncomplete="PF('checkPosition').show();" />
				</p:column>
				<p:column headerText="Guião">
					<p:commandButton value="Consultar" style="width:100%"
						icon="ui-icon-zoomin"
						actionListener="#{positionSearchCDI.setCheckScript(p.defaultScript)}"
						oncomplete="PF('checkScriptMyPos').show();"
						update="checkScriptFormMyPos" />
				</p:column>
				<p:column headerText="Ver candidaturas">
					<p:commandButton value="Seleccionar" style="width:100%"
						rendered="#{!positionSearchCDI.checkPosition(p)}"
						actionListener="#{positionSearchCDI.setPosition(p)}"
						icon="ui-icon-suitcase"
						update="@form messages submissionsPos
						editSubmissionStatus editSubmissionReason" />
					<p:commandButton rendered="#{positionSearchCDI.checkPosition(p)}"
						style="width:100%" value="Cancelar"
						actionListener="#{positionSearchCDI.unloadPosition()}"
						icon="ui-icon-cancel"
						update="@form messages submissionsPos
						editSubmissionStatus editSubmissionReason" />
				</p:column>
			</p:dataTable>

		</h:form>

		<h:form id="checkScriptFormMyPos">
			<p:dialog widgetVar="checkScriptMyPos" draggable="false"
				resizable="false" modal="true" style="max-width:300px"
				header="Guião">
				<h:panelGrid>
					<p:outputLabel
						value="Título: #{positionSearchCDI.checkScript.title}" />
					<br />
					<p:outputLabel
						value="Comentários: #{positionSearchCDI.checkScript.comments}" />
					<br />
					<p:dataTable id="questionsTable" emptyMessage="Sem questões."
						var="q" value="#{positionSearchCDI.checkScript.questions}"
						paginatorTemplate="{CurrentPageReport}  {FirstPageLink} 
						{PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
						paginator="true" rows="10">
						<f:facet name="header">Questões</f:facet>
						<p:column headerText="Título">
							<h:outputText value="#{q.question}" />
						</p:column>
						<p:column headerText="Tipo">
							<h:outputText
								value="#{positionSearchCDI.getTypeTextOfQuestion(q)}" />
						</p:column>
					</p:dataTable>
				</h:panelGrid>
				<p:commandButton value="Fechar"
					onclick="PF('checkScriptMyPos').hide();" />
			</p:dialog>
		</h:form>

		<h:form id="submissionsPos">
			<h:panelGrid rendered="#{positionSearchCDI.loadedPosition()}">
				<h2>Posição #{positionSearchCDI.position.positionCode},
					#{positionSearchCDI.position.title} -
					#{positionSearchCDI.position.company}</h2>
			</h:panelGrid>
			<h:panelGrid rendered="#{positionSearchCDI.checkIfClosed()}">
				<h3>Data de fecho: #{positionSearchCDI.position.closingDate}</h3>
			</h:panelGrid>
			<h:panelGrid rendered="#{positionSearchCDI.checkIfNotClosed()}">
				<h3>Vagas ainda em aberto:
					#{positionSearchCDI.availableOpenings()}</h3>
			</h:panelGrid>
			<p:dataTable emptyMessage="A posição não tem candidaturas." var="s"
				rendered="#{positionSearchCDI.loadedPosition()}"
				value="#{positionSearchCDI.submissions}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">
				<f:facet name="header">Candidaturas da posição</f:facet>
				<p:column headerText="Data">
					<h:outputText
						value="#{positionSearchCDI.getDateWithoutTime(s.date)}" />
				</p:column>
				<p:column headerText="Estado">
					<h:outputText value="#{s.status}" />
				</p:column>
				<p:column headerText="Carta de Motivação">
					<h:panelGroup rendered="#{s.candidate.uploadedCV}">
						<a href="#{submissionSearchCDI.getMotivatioLetterPath(s)}"
							target="_blank">Consultar a Carta de Motivação</a>
					</h:panelGroup>
				</p:column>
				<p:column headerText="CV">
					<h:panelGroup rendered="#{s.candidate.uploadedCV}">
						<a href="#{submissionSearchCDI.getCvPath(s)}" target="_blank">
							Consultar CV</a>
					</h:panelGroup>
				</p:column>
				<p:column headerText="Mudar o estado">
					<p:commandButton value="Seleccionar" style="width:100%"
						rendered="#{!positionSearchCDI.checkSubmission(s)}"
						actionListener="#{positionSearchCDI.setSubmission(s)}"
						icon="ui-icon-person"
						update="@form messages editSubmissionStatus editSubmissionReason" />
					<p:commandButton rendered="#{positionSearchCDI.checkSubmission(s)}"
						style="width:100%" value="Cancelar"
						actionListener="#{positionSearchCDI.unloadSubmission()}"
						icon="ui-icon-cancel" update="@form messages editSubmissionStatus" />
				</p:column>
			</p:dataTable>
			<p:messages />

		</h:form>

		<!-- Status -->
		<h:form id="editSubmissionStatus">

			<h:panelGrid rendered="#{positionSearchCDI.loadedSubmission()}">
				<h2>Candidatura de
					#{positionSearchCDI.submission.candidate.firstName}
					#{positionSearchCDI.submission.candidate.lastName} à posição
					#{positionSearchCDI.submission.position.positionCode}</h2>
			</h:panelGrid>
			<h:panelGrid columns="3" style="width:1000px"
				rendered="#{positionSearchCDI.loadedSubmission()}">

				<p:outputLabel rendered="#{!positionSearchCDI.needsReason}"
					for="edit-submission-status" value="Estado: " />

				<h:panelGroup>
					<h:panelGrid columns="4" style="width:100%">
						<p:selectOneMenu id="edit-submission-status" style="width:100%"
							value="#{positionSearchCDI.statusSub}"
							rendered="#{!positionSearchCDI.needsReason}">
							<f:selectItems value="#{positionSearchCDI.availableStatusSub}" />
							<f:ajax event="change" />
						</p:selectOneMenu>
						<p:commandButton value="Actualizar estado" style="width:100%"
							action="#{positionSearchCDI.updateStatusSub()}"
							icon="ui-icon-disk"
							update="submissionsPos
								editSubmissionStatus editSubmissionReason messages"
							rendered="#{!positionSearchCDI.needsReason}">
							<p:confirm header="Confirmação"
								message="Tem a certeza que quer actualizar o estado da candidatura?"
								icon="ui-icon-alert" />
						</p:commandButton>

						<p:confirmDialog global="true">
							<h:panelGrid columns="2" style="width:100%">
								<p:commandButton value="Sim" type="button" style="width:100%"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button" style="width:100%"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</h:panelGrid>
						</p:confirmDialog>

					</h:panelGrid>
				</h:panelGroup>
			</h:panelGrid>

		</h:form>

		<h:form id="editSubmissionReason ">
			<h:panelGrid rendered="#{positionSearchCDI.needsReason}">
				<p:outputLabel value="Motivo de rejeição: *"
					for="edit-submission-reason" />
				<p:inputTextarea value="#{positionSearchCDI.reason}" rows="10"
					cols="50" maxlength="100" counter="maxDescriptionSub"
					id="edit-submission-reason" />
				<h:outputText id="maxDescriptionSub" />
				<p:messages />

				<p:commandButton icon="ui-icon-disk"
					value="Mudar para estado rejeitado e 
						gravar motivo de rejeição"
					style="width:100%"
					action="#{positionSearchCDI.saveRejectedReason()}"
					update="editSubmissionReason editSubmissionStatus
					submissionsPos messages" />
			</h:panelGrid>

		</h:form>

	</ui:composition>

</h:body>
</html>
