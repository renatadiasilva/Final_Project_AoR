<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">
<h:head></h:head>
<h:body>

	<ui:composition>

		<h1>Editar estado da Candidatura</h1>

		<h:form id="editSubmission">

			<p:dataTable emptyMessage="Não há candidaturas." var="s"
				value="#{submissionSearchCDI.submissions}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
				 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
				paginator="true" rows="10">
				<f:facet name="header">Candidaturas</f:facet>
				<p:column headerText="id">
					<h:outputText value="#{s.id}" />
				</p:column>
				<p:column headerText="Data">
					<h:outputText
						value="#{submissionSearchCDI.getDateWithoutTime(s.date)}" />
				</p:column>
				<p:column headerText="Posição">
					<h:outputText value="#{s.position.positionCode}" />
				</p:column>
				<p:column headerText="Estado">
					<h:outputText value="#{s.status}" />
				</p:column>
				<p:column headerText="Carta de Motivação">
					<h:panelGroup rendered="#{s.candidate.uploadedCV}">
						<a href="#{submissionSearchCDI.getMotivatioLetterPath(s)}"
							target="_blank">Consultar a Carta de Motivação</a>
					</h:panelGroup>
				</p:column>
				<p:column headerText="CV">
					<h:panelGroup rendered="#{s.candidate.uploadedCV}">
						<a href="#{submissionSearchCDI.getCvPath(s)}" target="_blank">
							Consultar CV</a>
					</h:panelGroup>
				</p:column>
				<p:column headerText="Seleccionar">
					<p:commandButton value="Seleccionar" style="width:100%"
						rendered="#{!submissionSearchCDI.checkSubmission(s)}"
						actionListener="#{submissionSearchCDI.setSubmission(s)}"
						icon="ui-icon-person" 
						update="@form messages editSubmissionStatus editSubmissionReason" />
					<p:commandButton
						rendered="#{submissionSearchCDI.checkSubmission(s)}"
						style="width:100%" value="Cancelar"
						actionListener="#{submissionSearchCDI.unloadSubmission()}"
						icon="ui-icon-cancel" update="@form messages editSubmissionStatus" />
				</p:column>
			</p:dataTable>
			<br />
		</h:form>

		<!-- Status -->
		<h:form id="editSubmissionStatus">

			<h:panelGrid rendered="#{submissionSearchCDI.loadedSubmission()}">
				<h2>Candidatura de
					#{submissionSearchCDI.submission.candidate.firstName}
					#{submissionSearchCDI.submission.candidate.lastName} à posição
					#{submissionSearchCDI.submission.position.positionCode}</h2>
			</h:panelGrid>
			<h:panelGrid columns="3" style="width:1000px"
				rendered="#{submissionSearchCDI.loadedSubmission()}">

				<p:outputLabel rendered="#{!submissionSearchCDI.needsReason}" 
					for="edit-submission-status" value="Estado: " />

				<h:panelGroup>
					<h:panelGrid columns="4" style="width:100%">
						<p:selectOneMenu id="edit-submission-status" style="width:100%"
							value="#{submissionSearchCDI.status}"
							rendered="#{!submissionSearchCDI.needsReason}">
							<f:selectItems value="#{submissionSearchCDI.availableStatus}" />
							<f:ajax event="change" />
						</p:selectOneMenu>
						<p:commandButton value="Actualizar estado" style="width:100%"
							action="#{submissionSearchCDI.updateStatus()}"
							icon="ui-icon-disk"
							update="editSubmission 
								editSubmissionStatus editSubmissionReason messages"
							rendered="#{!submissionSearchCDI.needsReason}">
							<p:confirm header="Confirmação"
								message="Tem a certeza que quer actualizar o estado da candidatura?"
								icon="ui-icon-alert" />
						</p:commandButton>

						<p:confirmDialog global="true">
							<h:panelGrid columns="2" style="width:100%">
								<p:commandButton value="Sim" type="button" style="width:100%"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button" style="width:100%"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</h:panelGrid>
						</p:confirmDialog>

					</h:panelGrid>
				</h:panelGroup>
			</h:panelGrid>

		</h:form>

		<h:form id="editSubmissionReason">
			<h:panelGrid rendered="#{submissionSearchCDI.needsReason}">
				<p:outputLabel value="Motivo de rejeição: *"
					for="edit-submission-reason" />
				<p:inputTextarea value="#{submissionSearchCDI.reason}" rows="10"
					cols="50" maxlength="100" counter="maxDescriptionSub"
					id="edit-submission-reason" />
				<h:outputText id="maxDescriptionSub" />
				<p:messages />

				<p:commandButton icon="ui-icon-disk"
					value="Mudar para estado rejeitado e 
						gravar motivo de rejeição"
					style="width:100%"
					action="#{submissionSearchCDI.saveRejectedReason()}"
					update="editSubmissionReason editSubmissionStatus
					editSubmission messages" />
			</h:panelGrid>

		</h:form>

	</ui:composition>

</h:body>
</html>
